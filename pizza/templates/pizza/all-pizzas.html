{% extends "base.html" %}
{% load static %}
{% block title %}All Pizzas{% endblock %}
{% block content%}
<h1 class="display-1 text-center">PizzaPython</h1>
{% include "nav-small.html" %}
<section class="container pt-2 pb-2 shadow-sm">
    <h2 class="h1">Pizza list</h2>
    <div class="row">
        <!-- start for loop -->
        {% for pizza in object_list %}
        <div class="col-12 col-md-6 col-lg-4 col-xl-3 card px-2 my-2">
            <!-- check for matching user -->
            {% if user == pizza.user_id %}
            <h4>Your Pizza:</h4>
            {%endif%}
            <!-- highlight Pizza if featured on homepage -->
            {% if pizza.show_on_homepage %}
            <div class="text-align-right">
                <span class="alert alert-success p-1 text-center">Featured on Homepage!</span>
            </div>
            {% endif %}
            <!-- add my-pizza class if user matches -->
            <div class="card-body shadow{% if user == pizza.user_id %} my-pizza{%endif%}">
                <!-- The pizza content inside the card-text. -->
                <div id="{{pizza.slug}}" class="card-text">
                    <h2>{{pizza.title}}</h2>
                    <p class="subtitle">Made by {{ pizza.user_id }}
                        <br>Created on {{ pizza.created_on }}
                        <!-- Show modified date if it is different to created date -->
                        {% if not pizza.updated_on == pizza.created_on %}
                        <br>Modified on {{ pizza.updated_on }}
                        {% endif %}
                    </p>
                    <p>{{ pizza.base_id.name }}
                        <br>
                        <!-- show icons for cheese and sauce -->
                        <span class="px-0">
                            {% if not pizza.cheese %}
                                <i class="fa-solid fa-xmark red" title="No cheese"></i>
                                <span class="sr-only">No cheese</span>
                                {% else %}
                                <i class="fa-solid fa-check green" title="With cheese"></i>
                                <span class="sr-only">With cheese</span>
                                {% endif %}
                                Cheese
                        </span>
                        <span class="px-2">
                            {% if not pizza.tom_sauce %}
                                <i class="fa-solid fa-xmark red" title="No sauce"></i>
                                <span class="sr-only">No sauce</span>
                                {% else %}
                                <i class="fa-solid fa-check green" title="With sauce"></i>
                                <span class="sr-only">With sauce</span>
                                {% endif %}
                                Sauce
                        </span>
                        <br>
                        <!-- loop through toppings -->
                        {% for topping in pizza.topping_id.all %}
                        <i class="fa-solid fa-plus"></i>{{topping.name}}
                        {% endfor %}
                    </p>
                </div>
                <!-- user needs to be logged in to add or order Pizzas -->
                <div class="row pr-2 m-1">{% if user.is_authenticated %}
                    <a class="col-12 p-2 text-center btn btn-order btn-primary"
                        href="#" data-slug-field="{{pizza.slug}}">Order this Pizza
                    </a>
                </div>
                <div class="row m-1">
                    <!-- only the Pizza's creator can edit or delete this Pizza -->
                    {% if user == pizza.user_id %}
                    <a class="col-6 p-1 btn btn-primary"
                        href="{% url 'edit_pizza' pizza.slug %}">Edit this pizza
                    </a>
                    <a class="col-6 p-1 btn btn-danger btn-delete"
                        href="{% url 'delete_pizza' pizza.slug %}">Delete this pizza
                    </a>
                    {% endif %}
                    {% else %}
                    <a class="col-12" href="{% url 'login' %}">Login to order or manage this Pizza</a>
                    {% endif %}
                </div>
            </div>
            <hr>
        </div>
        <!-- end looping through Pizzas -->
        {% endfor %}
    </div>
</section>
{% endblock %}
<!-- code for order and delete confirmation modal -->
{% block modal-title %}Order Confirmation{% endblock %}
{% block modal-content %}
<div id="modal-content"></div>
{% endblock %}
{% block modal-submit %}Confirm Order{% endblock %}